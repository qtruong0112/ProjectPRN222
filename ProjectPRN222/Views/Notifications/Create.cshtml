@{
    ViewData["Title"] = "T·∫°o Th√¥ng B√°o";
}

<div class="container py-4">
    <div class="row">
        <div class="col-md-6 offset-md-3">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">üì¢ T·∫°o Th√¥ng B√°o</h4>
                </div>
                <div class="card-body">
                    @if (!string.IsNullOrEmpty(ViewBag.Success))
                    {
                        <div class="alert alert-success">@ViewBag.Success</div>
                    }
                    
                    @if (!string.IsNullOrEmpty(ViewBag.Error))
                    {
                        <div class="alert alert-danger">@ViewBag.Error</div>
                    }

                    <form method="post">
                        <div class="mb-3">
                            <label for="notificationType" class="form-label">Lo·∫°i th√¥ng b√°o</label>
                            <select class="form-control" id="notificationType" name="notificationType" required onchange="toggleFields()">
                                <option value="">-- Ch·ªçn lo·∫°i th√¥ng b√°o --</option>
                                <option value="single">G·ª≠i cho 1 ng∆∞·ªùi d√πng c·ª• th·ªÉ</option>
                                <option value="role">G·ª≠i theo vai tr√≤</option>
                                <option value="all">G·ª≠i cho t·∫•t c·∫£ ng∆∞·ªùi d√πng</option>
                            </select>
                        </div>

                        <!-- Tr∆∞·ªùng User ID - ch·ªâ hi·ªÉn th·ªã khi ch·ªçn "single" -->
                        <div class="mb-3" id="userIdGroup" style="display: none;">
                            <label for="userId" class="form-label">User ID</label>
                            <input type="number" class="form-control" id="userId" name="userId">
                            <small class="form-text text-muted">Nh·∫≠p ID c·ªßa ng∆∞·ªùi d√πng</small>
                        </div>

                        <!-- Tr∆∞·ªùng Role - ch·ªâ hi·ªÉn th·ªã khi ch·ªçn "role" -->
                        <div class="mb-3" id="roleGroup" style="display: none;">
                            <label for="roleId" class="form-label">Vai tr√≤</label>
                            <select class="form-control" id="roleId" name="roleId">
                                <option value="">-- Ch·ªçn vai tr√≤ --</option>
                                @foreach (var role in ViewBag.Roles)
                                {
                                    <option value="@role.RoleId">@role.RoleName</option>
                                }
                            </select>
                        </div>

                        <!-- Th√¥ng tin khi ch·ªçn "all" -->
                        <div class="mb-3" id="allUsersInfo" style="display: none;">
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle"></i> Th√¥ng b√°o s·∫Ω ƒë∆∞·ª£c g·ª≠i cho t·∫•t c·∫£ ng∆∞·ªùi d√πng trong h·ªá th·ªëng
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="message" class="form-label">N·ªôi dung th√¥ng b√°o</label>
                            <textarea class="form-control" id="message" name="message" rows="4" required 
                                      placeholder="Nh·∫≠p n·ªôi dung th√¥ng b√°o..."></textarea>
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="@Url.Action("Index")" class="btn btn-secondary me-md-2">H·ªßy</a>
                            <button type="submit" class="btn btn-primary">G·ª≠i th√¥ng b√°o</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function toggleFields() {
        const notificationType = document.getElementById('notificationType').value;
        const userIdGroup = document.getElementById('userIdGroup');
        const roleGroup = document.getElementById('roleGroup');
        const allUsersInfo = document.getElementById('allUsersInfo');
        const userIdInput = document.getElementById('userId');
        const roleIdSelect = document.getElementById('roleId');

        // ·∫®n t·∫•t c·∫£ c√°c tr∆∞·ªùng
        userIdGroup.style.display = 'none';
        roleGroup.style.display = 'none';
        allUsersInfo.style.display = 'none';

        // X√≥a required attribute
        userIdInput.removeAttribute('required');
        roleIdSelect.removeAttribute('required');

        // Hi·ªÉn th·ªã tr∆∞·ªùng t∆∞∆°ng ·ª©ng v√† th√™m required
        switch (notificationType) {
            case 'single':
                userIdGroup.style.display = 'block';
                userIdInput.setAttribute('required', 'required');
                break;
            case 'role':
                roleGroup.style.display = 'block';
                roleIdSelect.setAttribute('required', 'required');
                break;
            case 'all':
                allUsersInfo.style.display = 'block';
                break;
        }
    }

    // Kh·ªüi t·∫°o khi trang load
    document.addEventListener('DOMContentLoaded', function() {
        toggleFields();
    });
</script>